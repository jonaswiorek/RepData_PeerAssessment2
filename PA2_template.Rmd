---
title: "Public health and economic problems caused by severe weather events"
author: "Jonas Wiorek"
date: "12 Mar 2015"
output: html_document
---
##Synopsis
In this report we describe the public health and economic problems caused by storms and other severe weather events across the United States from 1950 to November 2011. In particular, we describe the types of events which are most harmful with respect to population health, and the types of events which have the greatest economic consequences for communities and municipalities. It is a key concern to prevent such outcomes to the extent possible.
For this purpose the U.S. National Oceanic and Atmospheric Administration's (NOAA) storm database is studied. This database tracks characteristics of major storms and weather events in the United States, including when and where they occur, as well as estimates of any fatalities, injuries, and property damage.

##Data Processing
The data for this study come from U.S. National Oceanic and Atmospheric Administration's (NOAA) storm database in the form of a comma-separated-value file.
```{r, echo=TRUE, cache=TRUE}
stormData <- read.csv("./data/repdata-data-StormData.csv")
```


## Results
```{r, echo=TRUE, message=FALSE, warning=FALSE}
library(dplyr)
library(ggplot2)
library(xtable)
library(gridExtra)
```

### Most Harmful Population Health Events
The tables below shows the top ten most harmful severe weather events with respect to population health in form of fatalities respectively injures.  
```{r, echo=TRUE, results='asis'}         
eventFatalitiesInjuries <- summarize(group_by(stormData, EVTYPE), 
                                     fatalities = 
                                             as.integer(sum(FATALITIES, na.rm=TRUE)),
                                     injuries = 
                                             as.integer(sum(INJURIES, na.rm =TRUE)))


fatalitiesOrdered <- arrange(eventFatalitiesInjuries, desc(fatalities))
fatalitiesOrderedFiltered <- fatalitiesOrdered[1:10,]
xt1 <- xtable(fatalitiesOrderedFiltered[,1:2])
print.xtable(xt1, type = "html")

injuriesOrdered <- arrange(eventFatalitiesInjuries, desc(injuries))
injuriesOrderedFiltered <- injuriesOrdered[1:10,]
xt2 <- xtable(injuriesOrderedFiltered[,c(1,3)])
print.xtable(xt2, type = "html")

g1 <- ggplot(data=fatalitiesOrderedFiltered,aes(x=EVTYPE,y=fatalities)) +
  geom_bar( stat="identity") +
  scale_x_discrete(limits = fatalitiesOrderedFiltered$EVTYPE) +
  theme(text = element_text(size=12), axis.text.x = element_text(angle=90))

g2 <- ggplot(data=injuriesOrderedFiltered,aes(x=EVTYPE,y=injuries)) +
  geom_bar( stat="identity") +
  scale_x_discrete(limits = injuriesOrderedFiltered$EVTYPE) +
  theme(text = element_text(size=12), axis.text.x = element_text(angle=90))

#par(mfcol = c(1,2))
#grid.arrange(g1,g2)
```

### Events of Greatest Economic Consequences
The figure below shows the top ten types severe weather events which have the greatest economic consequences with respect to property respectively crop damages.
```{r, echo=TRUE, results='asis'}
eventPropertyCrop <- summarize(group_by(stormData, EVTYPE), 
                                     property = sum(PROPDMG, na.rm=TRUE),
                                     crop = sum(CROPDMG, na.rm =TRUE))

propertyOrdered <- arrange(eventPropertyCrop, desc(property))
propertyOrderedFiltered <- propertyOrdered[1:10,]

cropOrdered <- arrange(eventPropertyCrop, desc(crop))
cropOrderedFiltered <- cropOrdered[1:10,]

ggplot(data=propertyOrderedFiltered,aes(x=EVTYPE,y=property)) +
        geom_bar( stat="identity") +
        scale_x_discrete(limits = propertyOrderedFiltered$EVTYPE) +
        theme(text = element_text(size=12), axis.text.x = element_text(angle=90)) +
        ylab("Property Damage [$]")

ggplot(data=cropOrderedFiltered,aes(x=EVTYPE,y=crop)) +
        geom_bar( stat="identity") +
        scale_x_discrete(limits = cropOrderedFiltered$EVTYPE) +
        theme(text = element_text(size=12), axis.text.x = element_text(angle=90)) +
        ylab("Crop Damage [$]")
```


